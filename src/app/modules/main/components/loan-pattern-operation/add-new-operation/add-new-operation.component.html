<div *ngIf="visible" class="app-card p-6 rounded-2xl border border-slate-200">


    <div class="w-full app-card">
        <div class="p-8 rounded-xl shadow-sm mx-auto">
            <div class="flex flex-col w-full p-4">
                <div class="flex flex-col items-start text-right w-full">
                    <h2 class="text-2xl font-semibold mb-2">ุนููุงุช ุชุณููุงุช</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="p-6 space-y-6 rounded-2xl">
        <div [formGroup]="operationForm">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="flex flex-col">
                    <label class="mb-1 font-medium">ููุน ุนูุฏ:</label>
                    <input pInputText formControlName="contractType" class="normal-input flex-1" />
                </div>
                <div class="flex flex-col">
                    <label class="mb-1 font-medium">ุนููุงุช:</label>
                    <p-dropdown
                        [options]="operationList"
                        optionLabel="label"
                        optionValue="value"
                        formControlName="operation"
                        class="dropdown-normal"
                    ></p-dropdown>
                </div>
                <div class="flex flex-col">
                    <label class="mb-1 font-medium">ุงูููุช: <span class="text-red-500">*</span></label>
                    <input pInputText formControlName="priority" class="normal-input flex-1" />
                </div>
            </div>


        </div>
        <div class="flex flex-col">
            <div class="app-card p-4 rounded-xl border border-slate-200">
                <!-- ๐น ุฏฺฉูู ุงุฌุงุฏ ูุญุตูู -->
                <div class="my-2">
                    <button
                        pButton
                        iconPos="right"
                        class="p-button-primary normal-button"
                        type="button"
                        icon="pi pi-plus"
                        label="ุงูุฒูุฏู ุนููุงุช"
                        (click)="operationCreate()">
                    </button>
                </div>
                <p-table
                    [value]="operationTable"
                    styleClass="p-datatable-striped p-datatable-gridlines responsive-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th>ุฑุฏู</th>
                            <th>ุนููุงู ุนููุงุช</th>
                            <th>ุฑุฒ ุนููุงุช</th>
                            <th>ุนููุงุช</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowIndex + 1 }}</td>
                            <td>{{ row.title }}</td>
                            <td>
                                <button
                                    pButton
                                    label="..."
                                    class="p-button-primary p-button-outlined"
                                    (click)="showOperationDetails(row)"
                                ></button>
                            </td>
                            <td>
                                <button
                                    pButton
                                    label="..."
                                    class="p-button-sm p-button-danger"
                                    (click)="deleteOperation(rowIndex)"
                                ></button>
                            </td>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="4" class="text-center text-gray-500 py-4">ูฺ ุฑฺฉูุฑุฏ ุงูุช ูุดุฏ.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>

    <div class="flex justify-end gap-4 mt-8" dir="rtl">
        <button
            pButton
            label="ุชุฃุฏ"
            class="p-button p-button-success w-32 h-10"
            (click)="onConfirm()"
        ></button>
        <button
            pButton
            label="ุงูุตุฑุงู"
            class="p-button p-button-danger w-32 h-10"
            (click)="onCancel()"
        ></button>
    </div>

</div>
<!-- ๐น ุฏุงููฺฏ ุฑุฒ ุนููุงุช -->
<p-dialog
    header="ุฑุฒ ุนููุงุช ุชุณููุงุช"
    [(visible)]="showDetailDialog"
    [modal]="true"
    [style]="{ width: '800px' }"
    [draggable]="false"
    [resizable]="false"
>
    <form [formGroup]="detailOperationForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ุนููุงู ุนููุงุช -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">ุนููุงู ุนููุงุช:</label>
                <input
                    pInputText
                    formControlName="title"
                    [value]="selectedOperationTitle"
                    readonly
                    class="bg-gray-100"
                />
            </div>

            <!-- ุฑุฒ ุนููุงุช -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">ุฑุฒ ุนููุงุช: <span class="text-red-500">*</span></label>
                <p-dropdown
                    class="dropdown-normal"
                    [options]="detailList"
                    optionLabel="label"
                    optionValue="value"
                    formControlName="detail"
                    placeholder="ุงูุชุฎุงุจ ฺฉูุฏ"
                ></p-dropdown>
            </div>
        </div>

        <!-- ุฏฺฉููโูุง -->
        <div class="flex gap-4 mt-4">
            <button
                pButton
                label="ุงูุฒูุฏู ุฑุฒ ุนููุงุช"
                icon="pi pi-plus"
                class="p-button-success"
                type="button"
                (click)="addDetailOperation()"
            ></button>

            <button
                pButton
                label="ุญุฐู ุฑุฒ ุนููุงุช"
                icon="pi pi-trash"
                class="p-button-danger"
                type="button"
                (click)="deleteDetailOperation(detailOperationTable.length - 1)"
            ></button>
        </div>

        <!-- ุฌุฏูู ุฑุฒ ุนููุงุช -->
        <p-table
            [value]="detailOperationTable"
            styleClass="p-datatable-striped p-datatable-gridlines responsive-table mt-4"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th>ุฑุฏู</th>
                    <th>ุนููุงู ุฑุฒ ุนููุงุช</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                <tr>
                    <td>{{ rowIndex + 1 }}</td>
                    <td>{{ row.detail }}</td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="2" class="text-center text-gray-500 py-4">ูฺ ุฑุฒ ุนููุงุช ุซุจุช ูุดุฏู.</td>
                </tr>
            </ng-template>
        </p-table>

        <!-- ุฏฺฉููโูุง ูพุงู -->
        <div class="flex justify-end gap-4 mt-6">
            <button
                pButton
                label="ุชุฃุฏ"
                class="p-button p-button-success w-32 h-10"
                type="button"
                (click)="showDetailDialog = false"
            ></button>
            <button
                pButton
                label="ุงูุตุฑุงู"
                class="p-button p-button-danger w-32 h-10"
                type="button"
                (click)="showDetailDialog = false"
            ></button>
        </div>
    </form>
</p-dialog>
