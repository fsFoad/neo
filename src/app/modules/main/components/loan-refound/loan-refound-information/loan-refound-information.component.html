<div class="w-full bg-white" *ngIf="!showForm">
    <div class="p-8 rounded-xl shadow-sm  mx-auto">
        <div class="flex flex-col w-full p-4">
            <div class="flex flex-col items-start text-right w-full">
                <h2 class="text-2xl font-semibold mb-2">
                    اطلاعات بازپرداخت تسهیلات
                </h2>
            </div>
        </div>
    </div>
</div>


<div class="p-6 space-y-6 rounded-2xl" *ngIf="!showForm">
    <div [formGroup]="paymentForm" class="bg-white p-6 rounded-xl border border-slate-200">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">


        <!-- نحوه بازپرداخت -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">نحوه بازپرداخت: <span class="text-red-500">*</span></label>
                <div class="flex items-center gap-4 mt-2">
                    <div class="flex items-center gap-1">
                        <input type="radio" value="cash" formControlName="payType" />
                        <label>نقدی</label>
                    </div>
                    <div class="flex items-center gap-1">
                        <input type="radio" value="installment" formControlName="payType" />
                        <label>اقساطی</label>
                    </div>
                </div>
            </div>

            <!-- تاریخ مؤثر -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">تاریخ مؤثر:</label>
                <input
                    pInputText
                    formControlName="effectiveDate"
                    class="normal-input"
                />
            </div>

            <!-- روش بازپرداخت -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">روش بازپرداخت: <span class="text-red-500">*</span></label>
                <p-dropdown
                    class="normal-dropdown"
                    [options]="paymentMethodList"
                    optionLabel="label"
                    optionValue="value"
                    formControlName="paymentMethod"
                    placeholder="انتخاب کنید">
                </p-dropdown>
            </div>

            <!-- مبلغ بازپرداخت -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">مبلغ بازپرداخت این نوبت (ریال):</label>
                <input
                    pInputText
                    formControlName="paymentAmount"
                    class="normal-input"
                />
            </div>

            <!-- تعداد اقساط -->
            <div class="flex flex-col">
                <label class="mb-1 font-medium">تعداد اقساط بازپرداخت این نوبت:</label>
                <input
                    pInputText
                    formControlName="installmentCount"
                    class="normal-input"
                />
            </div>

            <!-- دکمه محاسبه — هم‌راستا + ۵۰٪ عرض -->
            <div class="flex items-end">
                <button
                    pButton
                    label="محاسبه"
                    class="p-button-primary normal-button"
                    style="width: 50%;"
                ></button>
            </div>


            </div>
        <div class="bg-white p-4 rounded-xl border border-slate-200 mt-4">
            <p-table
                [value]="installmentTable"
                styleClass="p-datatable-striped p-datatable-gridlines w-full">


                <ng-template pTemplate="caption">
                    <h3 class="text-base font-semibold">اقساط قرارداد</h3>
                </ng-template>

                <ng-template pTemplate="header">
                    <tr>
                        <th>ردیف</th>
                        <th>شماره/فسخ قرارداد</th>
                        <th>وضعیت</th>
                        <th>سررسید</th>
                        <th>تاریخ ثبت</th>
                        <th>اصل</th>
                        <th>سود/کارمزد</th>
                        <th>خسارت تأخیر</th>
                        <th>سود/کارمزد دوره تنفس</th>
                        <th>سود دوره ساخت</th>
                        <th>مانده اصل</th>
                        <th>مانده سود/کارمزد</th>
                        <th>مانده خسارت تأخیر</th>
                        <th>مانده سود/کارمزد دوره تنفس</th>
                        <th>مانده سود دوره ساخت</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-row let-index="rowIndex">
                    <tr>
                        <td>{{ index + 1 }}</td>
                        <td>{{ row.contractNumber }}</td>
                        <td>{{ row.status }}</td>
                        <td>{{ row.dueDate }}</td>
                        <td>{{ row.registerDate }}</td>
                        <td>{{ row.asl }}</td>
                        <td>{{ row.sood }}</td>
                        <td>{{ row.delay }}</td>
                        <td>{{ row.restFee }}</td>
                        <td>{{ row.buildFee }}</td>
                        <td>{{ row.remAsl }}</td>
                        <td>{{ row.remSood }}</td>
                        <td>{{ row.remDelay }}</td>
                        <td>{{ row.remRestFee }}</td>
                        <td>{{ row.remBuildFee }}</td>
                    </tr>
                </ng-template>

            </p-table>
        </div>
        <div class="bg-white p-4 rounded-xl border border-slate-200 mt-4">
            <p-table
                [value]="installmentsTable"
                styleClass="p-datatable-striped p-datatable-gridlines w-full">



                <ng-template pTemplate="header">
                    <tr>
                        <th>اصل</th>
                        <th>سود/کارمزد</th>
                        <th>خسارت تأخیر</th>
                        <th>سود/کارمزد دوره تنفس</th>
                        <th>سود دوره ساخت</th>
                        <th>جمع کل</th>
                        <th>مانده بدهی</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-row>
                    <tr>
                        <td>{{ row.asl }}</td>
                        <td>{{ row.sood }}</td>
                        <td>{{ row.delay }}</td>
                        <td>{{ row.restFee }}</td>
                        <td>{{ row.buildFee }}</td>
                        <td>{{ row.total }}</td>
                        <td>{{ row.remaining }}</td>
                    </tr>
                </ng-template>

            </p-table>
        </div>

        <div class="bg-white p-4 rounded-xl border border-slate-200 mt-4">


            <p-table
                [value]="discountTable"
                styleClass="p-datatable-striped p-datatable-gridlines w-full">

                <ng-template pTemplate="header">
                    <tr>
                        <th>تخفیفات</th>
                        <th>مبلغ</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-row>
                    <tr>
                        <td>{{ row.title }}</td>
                        <td>{{ row.amount }}</td>
                    </tr>
                </ng-template>

            </p-table>

        </div>
    </div>
    </div>


